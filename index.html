<!DOCTYPE html>
<html>
	<head>
		<title>å­—ä½“æ‹†åˆ†å’Œè½¬æ¢å·¥å…·</title>
		<meta charset="utf-8" />
		<style>
			/* CSS å˜é‡ï¼Œä¾¿äºå…¨å±€ä¸»é¢˜è°ƒæ•´ */
			:root {
				--primary-color: #007bff;
				--primary-dark: #0056b3;
				--background-color: #f0f2f5;
				--card-background: #fff;
				--border-color: #e0e0e0;
				--text-color: #333;
				--placeholder-color: #a0a0a0;
				--success-bg: #d4edda;
				--success-color: #155724;
				--error-bg: #f8d7da;
				--error-color: #721c24;
				--info-bg: #e2e3e5;
				--info-color: #383d41;
				--button-text-color: white;
				--font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
			}

			body {
				font-family: var(--font-family);
				background: var(--background-color);
				padding: 20px;
				color: var(--text-color);
			}

			.container {
				max-width: 1000px;
				margin: 0 auto;
				background: var(--card-background);
				padding: 20px 30px;
				border-radius: 12px;
				box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
			}
			
			.tabs {
				display: flex;
				margin-bottom: 20px;
				border-bottom: 2px solid var(--border-color);
			}
			
			.tab {
				padding: 12px 24px;
				cursor: pointer;
				border: none;
				background: none;
				font-size: 16px;
				color: var(--text-color);
				border-bottom: 3px solid transparent;
				transition: all 0.3s ease;
			}
			
			.tab.active {
				color: var(--primary-color);
				border-bottom-color: var(--primary-color);
			}
			
			.tab-content {
				display: none;
			}
			
			.tab-content.active {
				display: block;
			}
			
			.language-options {
				display: flex;
				gap: 10px;
				margin-bottom: 20px;
			}
			
			.language-option {
				flex: 1;
				padding: 12px;
				border: 2px solid var(--border-color);
				border-radius: 8px;
				text-align: center;
				cursor: pointer;
				transition: all 0.3s ease;
			}
			
			.language-option.selected {
				border-color: var(--primary-color);
				background: rgba(0, 123, 255, 0.1);
			}
			
			.language-option:hover {
				border-color: var(--primary-color);
			}
			.content {
				width: 100%;
				display: flex;
				gap: 10px;
			}
			.left {
				flex: 1;
			}
			.right {
				width: 200px;
			}

			h1 {
				text-align: center;
				color: var(--primary-dark);
				margin-bottom: 25px;
				font-size: 24px;
				font-weight: 600;
			}

			.card {
				padding: 8px 10px;
				border-radius: 8px;
				border: 1px solid var(--border-color);
				margin-bottom: 25px;
				transition: box-shadow 0.3s ease;
			}

			.card:hover {
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
			}

			h3 {
				font-size: 16px;
				font-weight: 500;
				color: var(--primary-color);
				margin: 0;
			}

			.flex-container {
				display: flex;
				align-items: center;
				justify-content: space-between;
			}

			button {
				padding: 10px 18px;
				cursor: pointer;
				border: none;
				border-radius: 6px;
				background-color: var(--primary-color);
				color: var(--button-text-color);
				font-size: 14px;
				transition: background-color 0.2s ease, transform 0.1s ease;
				margin-left: 10px;
			}

			button:hover:not(:disabled) {
				background-color: var(--primary-dark);
				transform: translateY(-1px);
			}

			button:active:not(:disabled) {
				transform: translateY(1px);
			}

			button:disabled {
				background-color: #ccc;
				cursor: not-allowed;
			}

			.file-path {
				padding: 12px;
				border: 1px dashed var(--border-color);
				border-radius: 6px;
				margin-top: 10px;
				word-break: break-all;
				background-color: #f8f9fa;
				transition: border-color 0.2s ease;
				color: var(--placeholder-color);
				font-size: 14px;
			}

			.file-path.active {
				border-color: var(--primary-color);
				color: var(--text-color);
			}

			.result {
				padding: 15px;
				border-radius: 6px;
				margin-top: 15px;
				min-height: 50px;
				white-space: pre-wrap;
				word-wrap: break-word;
				font-family: monospace;
				line-height: 1.6;
				transition: background-color 0.3s ease;
				animation: fadeIn 0.5s ease-in-out;
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
				}

				to {
					opacity: 1;
				}
			}

			.result.success {
				background-color: var(--success-bg);
				color: var(--success-color);
			}

			.result.error {
				background-color: var(--error-bg);
				color: var(--error-color);
			}

			.result.info {
				background-color: var(--background-color);
				color: var(--info-color);
			}

			.checkbox-group {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
				gap: 15px;
				margin-top: 15px;
			}

			.checkbox-group label {
				display: flex;
				align-items: center;
				cursor: pointer;
				font-size: 14px;
				position: relative;
				padding-left: 30px;
			}

			.checkbox-group input[type="checkbox"] {
				position: absolute;
				opacity: 0;
				cursor: pointer;
				height: 0;
				width: 0;
			}

			.checkmark {
				position: absolute;
				top: 1px;
				left: 0;
				height: 16px;
				width: 16px;
				background-color: #eee;
				border-radius: 4px;
				border: 1px solid #ddd;
				transition: all 0.2s ease;
			}
			.checkbox-group .checkmark:after {
				left: 4px !important;
				top: 0 !important ;
				width: 4px !important;
				height: 10px !important;
			}

			.checkbox-group label:hover input ~ .checkmark {
				background-color: #ccc;
			}

			.checkbox-group input:checked ~ .checkmark {
				background-color: var(--primary-color);
				border-color: var(--primary-color);
			}

			.checkmark:after {
				content: "";
				position: absolute;
				display: none;
			}

			.checkbox-group input:checked ~ .checkmark:after {
				display: block;
			}

			.checkbox-group .checkmark:after {
				left: 6px;
				top: 2px;
				width: 6px;
				height: 12px;
				border: solid white;
				border-width: 0 3px 3px 0;
				transform: rotate(45deg);
			}

			textarea {
				width: 100%;
				padding: 10px;
				border-radius: 6px;
				border: 1px solid var(--border-color);
				box-sizing: border-box;
				margin-top: 10px;
				resize: vertical;
				min-height: 80px;
				font-size: 14px;
				transition: border-color 0.2s ease;
			}

			textarea:focus {
				outline: none;
				border-color: var(--primary-color);
				box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
			}

			.weight-options {
				display: flex;
				flex-wrap: wrap;
				gap: 10px;
				margin-top: 15px;
			}

			.weight-options label {
				padding: 8px 15px;
				border: 1px solid #ccc;
				border-radius: 20px;
				cursor: pointer;
				font-size: 14px;
				transition: all 0.2s ease;
				position: relative;
			}

			.weight-options input[type="checkbox"] {
				display: none;
			}

			.weight-options input:checked + label {
				background-color: var(--primary-color);
				color: white;
				border-color: var(--primary-color);
			}

			.weight-options label:hover:not(:has(input:checked)) {
				background-color: #f0f0f0;
			}

			.card-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.card-header h3 {
				margin: 0;
			}

			.format-options {
				display: flex;
				flex-wrap: wrap;
				gap: 10px;
				margin-top: 15px;
			}

			.format-options label {
				padding: 8px 15px;
				border: 1px solid #ccc;
				border-radius: 20px;
				cursor: pointer;
				font-size: 14px;
				transition: all 0.2s ease;
				position: relative;
			}

			.format-options input[type="checkbox"] {
				display: none;
			}

			.format-options input:checked + label {
				background-color: var(--primary-color);
				color: white;
				border-color: var(--primary-color);
			}

			.format-options label:hover:not(:has(input:checked)) {
				background-color: #f0f0f0;
			}
		</style>
	</head>

	<body>
		<div class="container">
			<h1>å­—ä½“æ‹†åˆ†å’Œè½¬æ¢å·¥å…· ğŸš€</h1>
			
			<div class="tabs">
				<button class="tab active" onclick="switchTab('split')">å­—ä½“æ‹†åˆ†</button>
				<button class="tab" onclick="switchTab('convert')">æ ¼å¼è½¬æ¢</button>
			</div>

			<!-- å­—ä½“æ‹†åˆ†æ ‡ç­¾é¡µ -->
			<div id="split-tab" class="tab-content active">
				<h2>å­—ä½“æ‹†åˆ†å’ŒCDNä¸Šä¼ </h2>
				
				<div class="form-group">
					<label for="split-input-file">é€‰æ‹©å­—ä½“æ–‡ä»¶ (.ttf, .otf)</label>
					<input type="text" id="split-input-file" placeholder="ç‚¹å‡»é€‰æ‹©å­—ä½“æ–‡ä»¶" readonly>
					<button class="button secondary" onclick="selectSplitInputFile()">é€‰æ‹©æ–‡ä»¶</button>
				</div>

				<div class="form-group">
					<label for="font-family">å­—ä½“æ—åç§°</label>
					<input type="text" id="font-family" placeholder="ä¾‹å¦‚: æœ‰çˆ±é­”å…½åœ†ä½“-M" value="æœ‰çˆ±é­”å…½åœ†ä½“-M">
				</div>

				<div class="form-group">
					<label>é€‰æ‹©è¯­è¨€ç±»å‹</label>
					<div class="language-options">
						<div class="language-option" data-lang="zh" onclick="selectLanguage('zh')">
							<strong>ç®€ä½“ä¸­æ–‡</strong><br>
							<small>unicode-zh-CN.txt</small>
						</div>
						<div class="language-option" data-lang="tc" onclick="selectLanguage('tc')">
							<strong>ç¹ä½“ä¸­æ–‡</strong><br>
							<small>unicode-zh-TW.txt</small>
						</div>
						<div class="language-option" data-lang="ja" onclick="selectLanguage('ja')">
							<strong>æ—¥æ–‡</strong><br>
							<small>unicode-ja.txt</small>
						</div>
					</div>
				</div>

				<div class="form-group">
					<label for="num-chunks">æ‹†åˆ†æ•°é‡</label>
					<input type="number" id="num-chunks" value="200" min="1" max="1000">
					<small>å»ºè®®å€¼ï¼š200-500ï¼Œæ•°é‡è¶Šå¤šæ–‡ä»¶è¶Šå°ä½†è¯·æ±‚è¶Šå¤š</small>
				</div>

				<div class="form-group">
					<label for="split-output-folder">è¾“å‡ºæ–‡ä»¶å¤¹ï¼ˆå¯é€‰ï¼‰</label>
					<input type="text" id="split-output-folder" placeholder="ç•™ç©ºåˆ™ä½¿ç”¨å­—ä½“æ–‡ä»¶æ‰€åœ¨ç›®å½•" readonly>
					<button class="button secondary" onclick="selectSplitOutputFolder()">é€‰æ‹©æ–‡ä»¶å¤¹</button>
				</div>

				<button class="button" onclick="startSplitProcess()" id="split-button">å¼€å§‹æ‹†åˆ†å’Œä¸Šä¼ </button>

				<div id="split-status" class="status" style="display: none;"></div>
				<div id="split-progress" class="progress" style="display: none;">
					<div class="progress-bar" id="split-progress-bar"></div>
				</div>
				<div id="split-results" class="result-list" style="display: none;"></div>
			</div>

			<!-- æ ¼å¼è½¬æ¢æ ‡ç­¾é¡µ -->
			<div id="convert-tab" class="tab-content">
				<h2>å­—ä½“æ ¼å¼è½¬æ¢</h2>
				<div class="content">
				<div class="left">
					<div class="card">
						<div class="card-header">
							<h3>ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©å­—ä½“æ–‡ä»¶</h3>
							<button onclick="selectInputFile()">é€‰å–æ–‡ä»¶</button>
						</div>
						<div id="inputFilePath" class="file-path">è¯·ç‚¹å‡»â€œé€‰å–æ–‡ä»¶â€æŒ‰é’®...</div>
					</div>

					<div class="card">
						<div class="card-header">
							<h3>ç¬¬äºŒæ­¥ï¼šé€‰æ‹©è¾“å‡ºä½ç½®ï¼ˆå¯é€‰ï¼‰</h3>
							<button onclick="selectOutputFolder()">é€‰æ‹©æ–‡ä»¶å¤¹</button>
						</div>
						<div id="outputFolderPath" class="file-path">å¦‚æœç•™ç©ºï¼Œæ–‡ä»¶å°†ä¿å­˜åœ¨åŸå§‹å­—ä½“æ‰€åœ¨çš„ç›®å½•ã€‚</div>
					</div>

					<div class="card">
						<h3>ç¬¬ä¸‰æ­¥ï¼šå®šä¹‰éœ€è¦ä¿ç•™çš„å­—ç¬¦ï¼ˆå¯é€‰ï¼‰</h3>
						<p style="font-size: 12px; color: #666">è¿™èƒ½å¤§å¤§å‡å°å­—ä½“æ–‡ä»¶ä½“ç§¯ã€‚</p>
						<div id="quickCharsContainer" class="checkbox-group"></div>
						<textarea
							id="subsetChars"
							rows="4"
							placeholder="ä½ ä¹Ÿå¯ä»¥åœ¨æ­¤å¤„è¾“å…¥æˆ–ç²˜è´´è‡ªå®šä¹‰æ–‡æœ¬ã€‚æˆ‘ä»¬ä¼šå°†ä½ è¾“å…¥çš„å­—ç¬¦ä¸ä½ é€‰æ‹©çš„å¿«æ·é€‰é¡¹ï¼ˆå¦‚ï¼šå…¨éƒ¨æ•°å­—/è‹±æ–‡ï¼‰è¿›è¡Œåˆå¹¶ï¼Œç„¶åè½¬æ¢å­—ä½“ã€‚"
							style="margin-top: 15px"
						></textarea>
					</div>

					<div class="card">
						<h3>ç¬¬å››æ­¥ï¼šé€‰æ‹©è¾“å‡ºæ ¼å¼</h3>
						<p style="font-size: 12px; color: #666">å¯ä»¥é€‰æ‹©å¤šç§è¾“å‡ºæ ¼å¼ã€‚</p>
						<div class="format-options">
							<input type="checkbox" id="format-woff" name="format" value="woff" />
							<label for="format-woff">WOFF</label>

							<input type="checkbox" id="format-woff2" name="format" value="woff2" checked />
							<label for="format-woff2">WOFF2</label>
						</div>
					</div>
					<div class="card" id="weightCard" style="display: none">
						<h3>ç¬¬äº”æ­¥ï¼šé€‰æ‹©å­—é‡ï¼ˆå¯å˜å­—ä½“ï¼‰</h3>
						<p style="font-size: 12px; color: #666">è¯¥å­—ä½“ä¸ºå¯å˜å­—ä½“ï¼Œè¯·é€‰æ‹©éœ€è¦å¯¼å‡ºçš„å­—é‡ç‰ˆæœ¬ã€‚</p>
						<div id="weightOptions" class="weight-options"></div>
					</div>
				</div>

				<div class="card right">
					<div class="card-header">
						<h3>å¼€å§‹è½¬æ¢</h3>
						<button id="convertBtn" onclick="startConversion()" disabled>å¼€å§‹è½¬æ¢</button>
					</div>
					<div id="result" class="result info">è¯·å®Œæˆå·¦ä¾§æ­¥éª¤ï¼Œç­‰å¾…æ‚¨çš„è½¬æ¢...</div>
				</div>
			</div>
		</div>

		<script>
			let inputFile = null
			let outputFolder = null
			let availableWeights = []
			
			// å­—ä½“æ‹†åˆ†ç›¸å…³å˜é‡
			let splitInputFile = ''
			let splitOutputFolder = ''
			let selectedLanguage = 'tc'
			
			// palåŒ…é…ç½®
			const PAL_CONFIG = {
				clientId: '1065', // éœ€è¦æ›¿æ¢ä¸ºå®é™…çš„clientId
				path:'activity',
				operate_id: 'web_fontmin_utils',
				retryCount: 1,
				withHash: false,
				hashAlgorithm: 'MD5',
			}

			// ç»Ÿä¸€å­—ç¬¦é›†å®šä¹‰
			const quickCharSets = {
				"å¸¸ç”¨(æ¨è)": "å¸¸ç”¨å­—ç¬¦é›†",
				å…¨éƒ¨æ•°å­—: "0123456789",
				å¤§å°å†™è‹±æ–‡: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",
				ç®€ä½“ä¸­æ–‡: "ç®€ä½“ä¸­æ–‡é›†",
				ç¹ä½“ä¸­æ–‡: "ç¹ä½“ä¸­æ–‡é›†",
				å…¨éƒ¨æ—¥æ–‡: "æ—¥æ–‡å­—ç¬¦é›†",
				å…¨éƒ¨éŸ©æ–‡: "éŸ©æ–‡å­—ç¬¦é›†"
			}
			const allUnicodeRanges = {
				å¸¸ç”¨å­—ç¬¦é›†: (() => {
					const chars = new Set()
					for (let i = 0x0021; i <= 0x007f; i++) chars.add(String.fromCharCode(i))
					for (let i = 0x4e00; i <= 0x9fff; i++) chars.add(String.fromCharCode(i))
					for (let i = 0x3000; i <= 0x303f; i++) chars.add(String.fromCharCode(i))
					for (let i = 0xff00; i <= 0xffef; i++) chars.add(String.fromCharCode(i))
					return Array.from(chars).join("")
				})(),
				ç®€ä½“ä¸­æ–‡é›†: Array.from({ length: 0x9fff - 0x4e00 + 1 }, (_, i) => String.fromCharCode(0x4e00 + i)).join(""),
				ç¹ä½“ä¸­æ–‡é›†:
					Array.from({ length: 0x4dbf - 0x3400 + 1 }, (_, i) => String.fromCharCode(0x3400 + i)).join("") +
					Array.from({ length: 0x9fff - 0x4e00 + 1 }, (_, i) => String.fromCharCode(0x4e00 + i)).join(""),
				æ—¥æ–‡å­—ç¬¦é›†:
					Array.from({ length: 0x309f - 0x3040 + 1 }, (_, i) => String.fromCharCode(0x3040 + i)).join("") +
					Array.from({ length: 0x30ff - 0x30a0 + 1 }, (_, i) => String.fromCharCode(0x30a0 + i)).join("") +
					Array.from({ length: 0x31ff - 0x31f0 + 1 }, (_, i) => String.fromCharCode(0x31f0 + i)).join(""),
				éŸ©æ–‡å­—ç¬¦é›†: Array.from({ length: 0xd7a3 - 0xac00 + 1 }, (_, i) => String.fromCharCode(0xac00 + i)).join("")
			}

			function renderQuickCharCheckboxes() {
				const container = document.getElementById("quickCharsContainer")
				container.innerHTML = ""
				Object.entries(quickCharSets).forEach(([label, value], index) => {
					const isDefault = label === "å¸¸ç”¨(æ¨è)"
					const inputId = `quick-char-${index}`
					container.innerHTML += `
                    <label for="${inputId}">
                        <input type="checkbox" id="${inputId}" data-chars="${value}" ${isDefault ? "checked" : ""}>
                        <span class="checkmark"></span>
                        ${label}
                    </label>
                `
				})
			}

			renderQuickCharCheckboxes()

			function updateResult(message, type) {
				const resultDiv = document.getElementById("result")
				resultDiv.innerText = message
				resultDiv.className = `result ${type || "info"}`
			}

			async function selectInputFile() {
				updateResult("æ­£åœ¨å‘¼å«æ–‡ä»¶é€‰æ‹©çª—å£ï¼Œè¯·ç¨å€™...", "info")
				inputFile = await window.pywebview.api.select_input_file()

				const inputPathDiv = document.getElementById("inputFilePath")
				const convertBtn = document.getElementById("convertBtn")

				if (inputFile) {
					inputPathDiv.innerText = inputFile
					inputPathDiv.classList.add("active")
					convertBtn.disabled = false
					outputFolder = null
					document.getElementById("outputFolderPath").innerText = "å¦‚æœç•™ç©ºï¼Œæ–‡ä»¶å°†ä¿å­˜åœ¨åŸå§‹å­—ä½“æ‰€åœ¨çš„ç›®å½•ã€‚"
					document.getElementById("outputFolderPath").classList.remove("active")
					updateResult("âœ… æ–‡ä»¶é€‰æ‹©æˆåŠŸï¼ç°åœ¨å¯ä»¥ç»§ç»­äº†ã€‚", "success")

					const weights = await window.pywebview.api.get_font_weights(inputFile)
					availableWeights = weights

					const weightCard = document.getElementById("weightCard")
					const weightOptions = document.getElementById("weightOptions")
					weightOptions.innerHTML = ""

					if (weights && weights.length > 0) {
						weightCard.style.display = "block"
						weights.forEach((weight) => {
							const inputId = `weight-${weight}`
							weightOptions.innerHTML += `
                            <input type="checkbox" id="${inputId}" name="weight" value="${weight}">
                            <label for="${inputId}">${weight}</label>
                        `
						})
					} else {
						weightCard.style.display = "none"
					}
				} else {
					updateResult("â„¹ï¸ æ‚¨å–æ¶ˆäº†æ–‡ä»¶é€‰æ‹©ã€‚", "info")
					inputPathDiv.innerText = "è¯·ç‚¹å‡»â€œé€‰å–æ–‡ä»¶â€æŒ‰é’®..."
					inputPathDiv.classList.remove("active")
					convertBtn.disabled = true
					document.getElementById("weightCard").style.display = "none"
				}
			}

			async function selectOutputFolder() {
				updateResult("æ­£åœ¨å‘¼å«æ–‡ä»¶å¤¹é€‰æ‹©çª—å£...", "info")
				const folderPath = await window.pywebview.api.select_output_folder()
				const outputFolderDiv = document.getElementById("outputFolderPath")

				if (folderPath) {
					outputFolder = folderPath
					outputFolderDiv.innerText = `å·²é€‰æ‹©ï¼š${outputFolder}`
					outputFolderDiv.classList.add("active")
					updateResult("âœ… è¾“å‡ºæ–‡ä»¶å¤¹é€‰æ‹©æˆåŠŸï¼", "success")
				} else {
					updateResult("â„¹ï¸ æ‚¨å–æ¶ˆäº†æ–‡ä»¶å¤¹é€‰æ‹©ã€‚å°†ä½¿ç”¨é»˜è®¤è¾“å‡ºä½ç½®ã€‚", "info")
					outputFolder = null
					outputFolderDiv.innerText = "å¦‚æœç•™ç©ºï¼Œæ–‡ä»¶å°†ä¿å­˜åœ¨åŸå§‹å­—ä½“æ‰€åœ¨çš„ç›®å½•ã€‚"
					outputFolderDiv.classList.remove("active")
				}
			}

			async function startConversion() {
				if (!inputFile) {
					updateResult("âŒ è¯·å…ˆé€‰æ‹©å­—ä½“æ–‡ä»¶å“¦ï¼", "error")
					return
				}

				const subsetChars = document.getElementById("subsetChars").value
				const selectedQuickChars = Array.from(document.querySelectorAll("#quickCharsContainer input:checked")).map(
					(el) => el.getAttribute("data-chars")
				)

				const allChars = Array.from(
					new Set(
						(
							subsetChars +
							selectedQuickChars
								.map((chars) => {
									return allUnicodeRanges[chars] || chars
								})
								.join("")
						).split("")
					)
				).join("")

				const selectedWeights = Array.from(document.querySelectorAll("#weightOptions input:checked")).map(
					(el) => el.value
				)

				const convertBtn = document.getElementById("convertBtn")
				convertBtn.disabled = true

				updateResult("ğŸš€ è½¬æ¢ä»»åŠ¡å·²æäº¤ï¼Œè¯·è€å¿ƒç­‰å¾…...", "info")

				const result = await window.pywebview.api.start_conversion(inputFile, allChars, selectedWeights, outputFolder)

				convertBtn.disabled = false

				if (result.success) {
					let message = `ğŸ‰ è½¬æ¢å®Œæˆï¼æ€»è€—æ—¶ï¼š${result.total_time_seconds.toFixed(2)} ç§’\n`
					if (result.paths && result.paths.length > 0) {
						message += "\nè½¬æ¢åçš„æ–‡ä»¶ä½äºï¼š\n" + result.paths.join("\n")
					}
					updateResult(message, "success")
				} else {
					updateResult(result.message, "error")
				}
			}

			async function startConversion() {
				if (!inputFile) {
					updateResult("âŒ è¯·å…ˆé€‰æ‹©å­—ä½“æ–‡ä»¶å“¦ï¼", "error")
					return
				}

				const selectedFormats = Array.from(document.querySelectorAll(".format-options input:checked")).map(
					(el) => el.value
				)

				if (selectedFormats.length === 0) {
					updateResult("âŒ è¯·è‡³å°‘é€‰æ‹©ä¸€ç§è¾“å‡ºæ ¼å¼ï¼", "error")
					return
				}

				const subsetChars = document.getElementById("subsetChars").value
				const selectedQuickChars = Array.from(document.querySelectorAll("#quickCharsContainer input:checked")).map(
					(el) => el.getAttribute("data-chars")
				)

				const allChars = Array.from(
					new Set(
						(
							subsetChars +
							selectedQuickChars
								.map((chars) => {
									return allUnicodeRanges[chars] || chars
								})
								.join("")
						).split("")
					)
				).join("")

				const selectedWeights = Array.from(document.querySelectorAll("#weightOptions input:checked")).map(
					(el) => el.value
				)

				const convertBtn = document.getElementById("convertBtn")
				convertBtn.disabled = true

				updateResult("ğŸš€ è½¬æ¢ä»»åŠ¡å·²æäº¤ï¼Œè¯·è€å¿ƒç­‰å¾…...", "info")

				const result = await window.pywebview.api.start_conversion(
					inputFile,
					allChars,
					selectedWeights,
					outputFolder,
					selectedFormats
				)

				convertBtn.disabled = false

				if (result.success) {
					let message = `ğŸ‰ è½¬æ¢å®Œæˆï¼æ€»è€—æ—¶ï¼š${result.total_time_seconds.toFixed(2)} ç§’\n`
					if (result.paths && result.paths.length > 0) {
						message += "\nè½¬æ¢åçš„æ–‡ä»¶ä½äºï¼š\n" + result.paths.join("\n")
					}
					updateResult(message, "success")
				} else {
					updateResult(result.message, "error")
				}
			}
			
			// å­—ä½“æ‹†åˆ†ç›¸å…³å‡½æ•°
			function switchTab(tabName) {
				// éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
				document.querySelectorAll('.tab-content').forEach(content => {
					content.classList.remove('active');
				});
				
				// ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
				document.querySelectorAll('.tab').forEach(tab => {
					tab.classList.remove('active');
				});
				
				// æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
				document.getElementById(tabName + '-tab').classList.add('active');
				event.target.classList.add('active');
			}

			function selectLanguage(lang) {
				selectedLanguage = lang;
				document.querySelectorAll('.language-option').forEach(option => {
					option.classList.remove('selected');
				});
				document.querySelector(`[data-lang="${lang}"]`).classList.add('selected');
			}

			function selectSplitInputFile() {
				pywebview.api.select_input_file().then(result => {
					if (result) {
						splitInputFile = result;
						document.getElementById('split-input-file').value = result;
					}
				});
			}

			function selectSplitOutputFolder() {
				pywebview.api.select_output_folder().then(result => {
					if (result) {
						splitOutputFolder = result;
						document.getElementById('split-output-folder').value = result;
					}
				});
			}

			function startSplitProcess() {
				const fontFamily = document.getElementById('font-family').value.trim();
				const numChunks = parseInt(document.getElementById('num-chunks').value);

				if (!splitInputFile) {
					showSplitStatus('error', 'è¯·å…ˆé€‰æ‹©å­—ä½“æ–‡ä»¶');
					return;
				}

				if (!fontFamily) {
					showSplitStatus('error', 'è¯·è¾“å…¥å­—ä½“æ—åç§°');
					return;
				}

				if (!selectedLanguage) {
					showSplitStatus('error', 'è¯·é€‰æ‹©è¯­è¨€ç±»å‹');
					return;
				}

				// ç¦ç”¨æŒ‰é’®
				document.getElementById('split-button').disabled = true;
				showSplitStatus('info', 'å¼€å§‹æ‹†åˆ†å­—ä½“...');
				showSplitProgress(0);

				// è°ƒç”¨Python API
				pywebview.api.split_font_and_generate_css(
					splitInputFile,
					fontFamily,
					selectedLanguage,
					numChunks,
					splitOutputFolder || null
				).then(result => {
					document.getElementById('split-button').disabled = false;
					
					if (result.success) {
						showSplitStatus('success', result.message);
						showSplitProgress(100);
						showSplitResults([
							`CSSæ–‡ä»¶: ${result.css_path}`,
							`å­é›†æ•°é‡: ${result.subset_count}`,
							`è¾“å‡ºç›®å½•: ${result.output_folder}`
						]);
					} else {
						showSplitStatus('error', result.message);
						hideSplitProgress();
					}
				}).catch(error => {
					document.getElementById('split-button').disabled = false;
					showSplitStatus('error', 'å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ' + error);
					hideSplitProgress();
				});
			}

			function showSplitStatus(type, message) {
				const statusEl = document.getElementById('split-status');
				statusEl.className = `status ${type}`;
				statusEl.textContent = message;
				statusEl.style.display = 'block';
			}

			function showSplitProgress(percent) {
				const progressEl = document.getElementById('split-progress');
				const progressBarEl = document.getElementById('split-progress-bar');
				progressEl.style.display = 'block';
				progressBarEl.style.width = percent + '%';
			}

			function hideSplitProgress() {
				document.getElementById('split-progress').style.display = 'none';
			}

			function showSplitResults(results) {
				const resultsEl = document.getElementById('split-results');
				resultsEl.innerHTML = results.map(result => 
					`<div class="result-item">${result}</div>`
				).join('');
				resultsEl.style.display = 'block';
			}

			// ä½¿ç”¨momoåŒ…çš„ä¸Šä¼ å‡½æ•°
			async function uploadToCDN(filePath, filename, language) {
				try {
					console.log('ğŸ” uploadToCDN å¼€å§‹æ‰§è¡Œ:');
					console.log('  - filePath:', filePath);
					console.log('  - filename:', filename);
					console.log('  - language:', language);
					
					// æ£€æŸ¥ fileUpload å‡½æ•°æ˜¯å¦å­˜åœ¨
					if (typeof window.fileUpload !== 'function') {
						throw new Error('fileUpload å‡½æ•°ä¸å­˜åœ¨');
					}
					console.log('âœ… fileUpload å‡½æ•°å­˜åœ¨');
					
					// åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„Fileå¯¹è±¡ï¼Œä¸éœ€è¦å®é™…è¯»å–æ–‡ä»¶
					const mockFile = new File([''], filename, { type: 'application/octet-stream' });
					console.log('âœ… æ¨¡æ‹ŸFileå¯¹è±¡åˆ›å»ºæˆåŠŸ:', mockFile.name);
					
					// ä½¿ç”¨æ¨¡æ‹Ÿçš„fileUploadå‡½æ•°
					console.log('ğŸ” å¼€å§‹æ¨¡æ‹Ÿä¸Šä¼ ...');
					const result = await window.fileUpload({
						clientId: '1065',
						file: [mockFile], // æ–‡ä»¶æ•°ç»„
						path: 'activity',
						operate_id: 'web_fontmin_utils',
						retryCount: 1,
						withHash: false,
						hashAlgorithm: 'MD5',
						onProgress: (percent) => {
							console.log(`ä¸Šä¼ è¿›åº¦: ${Math.round(percent * 100)}%`);
						},
						onSingleFinish: (res, index) => {
							console.log('å•ä¸ªæ–‡ä»¶ä¸Šä¼ å®Œæˆ:', res);
						}
					});
					
					console.log('ğŸ” ä¸Šä¼ ç»“æœ:', result);
					
					// è¿”å›ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„URL
					if (result && result.files && result.files.length > 0 && result.files[0].success) {
						const url = result.files[0].resourceUrl;
						console.log('âœ… ä¸Šä¼ æˆåŠŸï¼Œè¿”å›URL:', url);
						return url;
					} else {
						throw new Error('ä¸Šä¼ å¤±è´¥ï¼Œç»“æœ:', result);
					}
					
				} catch (error) {
					console.error('âŒ uploadToCDN å¤±è´¥:', error);
					throw error;
				}
			}

			// åˆå§‹åŒ–
			document.addEventListener('DOMContentLoaded', function() {
				selectLanguage('tc'); // é»˜è®¤é€‰æ‹©ç¹ä½“ä¸­æ–‡
				
				// æ·»åŠ è°ƒè¯•ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ
				const debugDiv = document.createElement('div');
				debugDiv.id = 'debug-info';
				debugDiv.style.cssText = `
					position: fixed;
					top: 10px;
					right: 10px;
					width: 300px;
					max-height: 400px;
					background: rgba(0,0,0,0.8);
					color: white;
					padding: 10px;
					border-radius: 5px;
					font-family: monospace;
					font-size: 12px;
					overflow-y: auto;
					z-index: 9999;
					display: none;
				`;
				document.body.appendChild(debugDiv);
				
				// é‡å†™console.logæ¥æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
				const originalLog = console.log;
				const originalError = console.error;
				
				console.log = function(...args) {
					originalLog.apply(console, args);
					const debugDiv = document.getElementById('debug-info');
					if (debugDiv) {
						debugDiv.innerHTML += '<div style="color: #00ff00;">[LOG] ' + args.join(' ') + '</div>';
						debugDiv.scrollTop = debugDiv.scrollHeight;
					}
				};
				
				console.error = function(...args) {
					originalError.apply(console, args);
					const debugDiv = document.getElementById('debug-info');
					if (debugDiv) {
						debugDiv.innerHTML += '<div style="color: #ff0000;">[ERROR] ' + args.join(' ') + '</div>';
						debugDiv.scrollTop = debugDiv.scrollHeight;
					}
				};
				
				// æ·»åŠ åˆ‡æ¢è°ƒè¯•ä¿¡æ¯çš„å¿«æ·é”®
				document.addEventListener('keydown', function(e) {
					if (e.ctrlKey && e.shiftKey && e.key === 'D') {
						const debugDiv = document.getElementById('debug-info');
						if (debugDiv) {
							debugDiv.style.display = debugDiv.style.display === 'none' ? 'block' : 'none';
						}
					}
				});
				
				console.log('è°ƒè¯•æ¨¡å¼å·²å¯ç”¨ï¼æŒ‰ Ctrl+Shift+D åˆ‡æ¢è°ƒè¯•ä¿¡æ¯æ˜¾ç¤º');
			});
		</script>
	</body>
	<script type="module">
		// ç”±äºPyInstalleræ‰“åŒ…åæ— æ³•æ­£ç¡®åŒ…å«node_modulesï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ¨¡æ‹Ÿçš„fileUploadå‡½æ•°
		console.log('ğŸ” åˆå§‹åŒ– fileUpload å‡½æ•°...');
		
		// åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„fileUploadå‡½æ•°ï¼Œè¿”å›çœŸå®çš„CDN URLæ ¼å¼
		window.fileUpload = async function(params) {
			console.log('ğŸ” æ¨¡æ‹Ÿ fileUpload è¢«è°ƒç”¨ï¼Œå‚æ•°:', params);
			
			// æ¨¡æ‹Ÿä¸Šä¼ è¿‡ç¨‹
			await new Promise(resolve => setTimeout(resolve, 1000));
			
			// ç”ŸæˆçœŸå®çš„CDN URLæ ¼å¼
			const fileName = params.file[0].name;
			const timestamp = Date.now();
			const randomId = Math.random().toString(36).substring(2, 8);
			
			// ä½¿ç”¨çœŸå®çš„CDNåŸŸåæ ¼å¼
			const cdnUrl = `https://cdn.example.com/uploads/${timestamp}_${randomId}_${fileName}`;
			
			console.log('âœ… æ¨¡æ‹Ÿä¸Šä¼ æˆåŠŸï¼Œè¿”å›URL:', cdnUrl);
			
			return {
				files: [{
					success: true,
					resourceUrl: cdnUrl,
					file: params.file[0],
					fileName: fileName,
					fileType: 4, // å­—ä½“æ–‡ä»¶ç±»å‹
					memory: params.file[0].size,
					index: 0
				}]
			};
		};
		
		console.log('âœ… æ¨¡æ‹Ÿ fileUpload å‡½æ•°å·²è®¾ç½®åˆ°å…¨å±€');
	</script>
</html>
