<!DOCTYPE html>
<html>
	<head>
		<title>字体拆分和转换工具</title>
		<meta charset="utf-8" />
		<style>
			/* CSS 变量，便于全局主题调整 */
			:root {
				--primary-color: #007bff;
				--primary-dark: #0056b3;
				--background-color: #f0f2f5;
				--card-background: #fff;
				--border-color: #e0e0e0;
				--text-color: #333;
				--placeholder-color: #a0a0a0;
				--success-bg: #d4edda;
				--success-color: #155724;
				--error-bg: #f8d7da;
				--error-color: #721c24;
				--info-bg: #e2e3e5;
				--info-color: #383d41;
				--button-text-color: white;
				--font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
			}

			body {
				font-family: var(--font-family);
				background: var(--background-color);
				padding: 20px;
				color: var(--text-color);
			}

			.container {
				max-width: 1000px;
				margin: 0 auto;
				background: var(--card-background);
				padding: 20px 30px;
				border-radius: 12px;
				box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
			}
			
			.tabs {
				display: flex;
				margin-bottom: 20px;
				border-bottom: 2px solid var(--border-color);
			}
			
			.tab {
				padding: 12px 24px;
				cursor: pointer;
				border: none;
				background: none;
				font-size: 16px;
				color: var(--text-color);
				border-bottom: 3px solid transparent;
				transition: all 0.3s ease;
			}
			
			.tab.active {
				color: var(--primary-color);
				border-bottom-color: var(--primary-color);
			}
			
			.tab-content {
				display: none;
			}
			
			.tab-content.active {
				display: block;
			}
			
			.language-options {
				display: flex;
				gap: 10px;
				margin-bottom: 20px;
			}
			
			.language-option {
				flex: 1;
				padding: 12px;
				border: 2px solid var(--border-color);
				border-radius: 8px;
				text-align: center;
				cursor: pointer;
				transition: all 0.3s ease;
			}
			
			.language-option.selected {
				border-color: var(--primary-color);
				background: rgba(0, 123, 255, 0.1);
			}
			
			.language-option:hover {
				border-color: var(--primary-color);
			}
			.content {
				width: 100%;
				display: flex;
				gap: 10px;
			}
			.left {
				flex: 1;
			}
			.right {
				width: 200px;
			}

			h1 {
				text-align: center;
				color: var(--primary-dark);
				margin-bottom: 25px;
				font-size: 24px;
				font-weight: 600;
			}

			.card {
				padding: 8px 10px;
				border-radius: 8px;
				border: 1px solid var(--border-color);
				margin-bottom: 25px;
				transition: box-shadow 0.3s ease;
			}

			.card:hover {
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
			}

			h3 {
				font-size: 16px;
				font-weight: 500;
				color: var(--primary-color);
				margin: 0;
			}

			.flex-container {
				display: flex;
				align-items: center;
				justify-content: space-between;
			}

			button {
				padding: 10px 18px;
				cursor: pointer;
				border: none;
				border-radius: 6px;
				background-color: var(--primary-color);
				color: var(--button-text-color);
				font-size: 14px;
				transition: background-color 0.2s ease, transform 0.1s ease;
				margin-left: 10px;
			}

			button:hover:not(:disabled) {
				background-color: var(--primary-dark);
				transform: translateY(-1px);
			}

			button:active:not(:disabled) {
				transform: translateY(1px);
			}

			button:disabled {
				background-color: #ccc;
				cursor: not-allowed;
			}

			.file-path {
				padding: 12px;
				border: 1px dashed var(--border-color);
				border-radius: 6px;
				margin-top: 10px;
				word-break: break-all;
				background-color: #f8f9fa;
				transition: border-color 0.2s ease;
				color: var(--placeholder-color);
				font-size: 14px;
			}

			.file-path.active {
				border-color: var(--primary-color);
				color: var(--text-color);
			}

			.result {
				padding: 15px;
				border-radius: 6px;
				margin-top: 15px;
				min-height: 50px;
				white-space: pre-wrap;
				word-wrap: break-word;
				font-family: monospace;
				line-height: 1.6;
				transition: background-color 0.3s ease;
				animation: fadeIn 0.5s ease-in-out;
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
				}

				to {
					opacity: 1;
				}
			}

			.result.success {
				background-color: var(--success-bg);
				color: var(--success-color);
			}

			.result.error {
				background-color: var(--error-bg);
				color: var(--error-color);
			}

			.result.info {
				background-color: var(--background-color);
				color: var(--info-color);
			}

			.checkbox-group {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
				gap: 15px;
				margin-top: 15px;
			}

			.checkbox-group label {
				display: flex;
				align-items: center;
				cursor: pointer;
				font-size: 14px;
				position: relative;
				padding-left: 30px;
			}

			.checkbox-group input[type="checkbox"] {
				position: absolute;
				opacity: 0;
				cursor: pointer;
				height: 0;
				width: 0;
			}

			.checkmark {
				position: absolute;
				top: 1px;
				left: 0;
				height: 16px;
				width: 16px;
				background-color: #eee;
				border-radius: 4px;
				border: 1px solid #ddd;
				transition: all 0.2s ease;
			}
			.checkbox-group .checkmark:after {
				left: 4px !important;
				top: 0 !important ;
				width: 4px !important;
				height: 10px !important;
			}

			.checkbox-group label:hover input ~ .checkmark {
				background-color: #ccc;
			}

			.checkbox-group input:checked ~ .checkmark {
				background-color: var(--primary-color);
				border-color: var(--primary-color);
			}

			.checkmark:after {
				content: "";
				position: absolute;
				display: none;
			}

			.checkbox-group input:checked ~ .checkmark:after {
				display: block;
			}

			.checkbox-group .checkmark:after {
				left: 6px;
				top: 2px;
				width: 6px;
				height: 12px;
				border: solid white;
				border-width: 0 3px 3px 0;
				transform: rotate(45deg);
			}

			textarea {
				width: 100%;
				padding: 10px;
				border-radius: 6px;
				border: 1px solid var(--border-color);
				box-sizing: border-box;
				margin-top: 10px;
				resize: vertical;
				min-height: 80px;
				font-size: 14px;
				transition: border-color 0.2s ease;
			}

			textarea:focus {
				outline: none;
				border-color: var(--primary-color);
				box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
			}

			.weight-options {
				display: flex;
				flex-wrap: wrap;
				gap: 10px;
				margin-top: 15px;
			}

			.weight-options label {
				padding: 8px 15px;
				border: 1px solid #ccc;
				border-radius: 20px;
				cursor: pointer;
				font-size: 14px;
				transition: all 0.2s ease;
				position: relative;
			}

			.weight-options input[type="checkbox"] {
				display: none;
			}

			.weight-options input:checked + label {
				background-color: var(--primary-color);
				color: white;
				border-color: var(--primary-color);
			}

			.weight-options label:hover:not(:has(input:checked)) {
				background-color: #f0f0f0;
			}

			.card-header {
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.card-header h3 {
				margin: 0;
			}

			.format-options {
				display: flex;
				flex-wrap: wrap;
				gap: 10px;
				margin-top: 15px;
			}

			.format-options label {
				padding: 8px 15px;
				border: 1px solid #ccc;
				border-radius: 20px;
				cursor: pointer;
				font-size: 14px;
				transition: all 0.2s ease;
				position: relative;
			}

			.format-options input[type="checkbox"] {
				display: none;
			}

			.format-options input:checked + label {
				background-color: var(--primary-color);
				color: white;
				border-color: var(--primary-color);
			}

			.format-options label:hover:not(:has(input:checked)) {
				background-color: #f0f0f0;
			}
		</style>
	</head>

	<body>
		<div class="container">
			<h1>字体拆分和转换工具 🚀</h1>
			
			<div class="tabs">
				<button class="tab active" onclick="switchTab('split')">字体拆分</button>
				<button class="tab" onclick="switchTab('convert')">格式转换</button>
			</div>

			<!-- 字体拆分标签页 -->
			<div id="split-tab" class="tab-content active">
				<h2>字体拆分和CDN上传</h2>
				
				<div class="form-group">
					<label for="split-input-file">选择字体文件 (.ttf, .otf)</label>
					<input type="text" id="split-input-file" placeholder="点击选择字体文件" readonly>
					<button class="button secondary" onclick="selectSplitInputFile()">选择文件</button>
				</div>

				<div class="form-group">
					<label for="font-family">字体族名称</label>
					<input type="text" id="font-family" placeholder="例如: 有爱魔兽圆体-M" value="有爱魔兽圆体-M">
				</div>

				<div class="form-group">
					<label>选择语言类型</label>
					<div class="language-options">
						<div class="language-option" data-lang="zh" onclick="selectLanguage('zh')">
							<strong>简体中文</strong><br>
							<small>unicode-zh-CN.txt</small>
						</div>
						<div class="language-option" data-lang="tc" onclick="selectLanguage('tc')">
							<strong>繁体中文</strong><br>
							<small>unicode-zh-TW.txt</small>
						</div>
						<div class="language-option" data-lang="ja" onclick="selectLanguage('ja')">
							<strong>日文</strong><br>
							<small>unicode-ja.txt</small>
						</div>
					</div>
				</div>

				<div class="form-group">
					<label for="num-chunks">拆分数量</label>
					<input type="number" id="num-chunks" value="200" min="1" max="1000">
					<small>建议值：200-500，数量越多文件越小但请求越多</small>
				</div>

				<div class="form-group">
					<label for="split-output-folder">输出文件夹（可选）</label>
					<input type="text" id="split-output-folder" placeholder="留空则使用字体文件所在目录" readonly>
					<button class="button secondary" onclick="selectSplitOutputFolder()">选择文件夹</button>
				</div>

				<button class="button" onclick="startSplitProcess()" id="split-button">开始拆分和上传</button>

				<div id="split-status" class="status" style="display: none;"></div>
				<div id="split-progress" class="progress" style="display: none;">
					<div class="progress-bar" id="split-progress-bar"></div>
				</div>
				<div id="split-results" class="result-list" style="display: none;"></div>
			</div>

			<!-- 格式转换标签页 -->
			<div id="convert-tab" class="tab-content">
				<h2>字体格式转换</h2>
				<div class="content">
				<div class="left">
					<div class="card">
						<div class="card-header">
							<h3>第一步：选择字体文件</h3>
							<button onclick="selectInputFile()">选取文件</button>
						</div>
						<div id="inputFilePath" class="file-path">请点击“选取文件”按钮...</div>
					</div>

					<div class="card">
						<div class="card-header">
							<h3>第二步：选择输出位置（可选）</h3>
							<button onclick="selectOutputFolder()">选择文件夹</button>
						</div>
						<div id="outputFolderPath" class="file-path">如果留空，文件将保存在原始字体所在的目录。</div>
					</div>

					<div class="card">
						<h3>第三步：定义需要保留的字符（可选）</h3>
						<p style="font-size: 12px; color: #666">这能大大减小字体文件体积。</p>
						<div id="quickCharsContainer" class="checkbox-group"></div>
						<textarea
							id="subsetChars"
							rows="4"
							placeholder="你也可以在此处输入或粘贴自定义文本。我们会将你输入的字符与你选择的快捷选项（如：全部数字/英文）进行合并，然后转换字体。"
							style="margin-top: 15px"
						></textarea>
					</div>

					<div class="card">
						<h3>第四步：选择输出格式</h3>
						<p style="font-size: 12px; color: #666">可以选择多种输出格式。</p>
						<div class="format-options">
							<input type="checkbox" id="format-woff" name="format" value="woff" />
							<label for="format-woff">WOFF</label>

							<input type="checkbox" id="format-woff2" name="format" value="woff2" checked />
							<label for="format-woff2">WOFF2</label>
						</div>
					</div>
					<div class="card" id="weightCard" style="display: none">
						<h3>第五步：选择字重（可变字体）</h3>
						<p style="font-size: 12px; color: #666">该字体为可变字体，请选择需要导出的字重版本。</p>
						<div id="weightOptions" class="weight-options"></div>
					</div>
				</div>

				<div class="card right">
					<div class="card-header">
						<h3>开始转换</h3>
						<button id="convertBtn" onclick="startConversion()" disabled>开始转换</button>
					</div>
					<div id="result" class="result info">请完成左侧步骤，等待您的转换...</div>
				</div>
			</div>
		</div>

		<script>
			let inputFile = null
			let outputFolder = null
			let availableWeights = []
			
			// 字体拆分相关变量
			let splitInputFile = ''
			let splitOutputFolder = ''
			let selectedLanguage = 'tc'
			
			// pal包配置
			const PAL_CONFIG = {
				clientId: '1065', // 需要替换为实际的clientId
				path:'activity',
				operate_id: 'web_fontmin_utils',
				retryCount: 1,
				withHash: false,
				hashAlgorithm: 'MD5',
			}

			// 统一字符集定义
			const quickCharSets = {
				"常用(推荐)": "常用字符集",
				全部数字: "0123456789",
				大小写英文: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",
				简体中文: "简体中文集",
				繁体中文: "繁体中文集",
				全部日文: "日文字符集",
				全部韩文: "韩文字符集"
			}
			const allUnicodeRanges = {
				常用字符集: (() => {
					const chars = new Set()
					for (let i = 0x0021; i <= 0x007f; i++) chars.add(String.fromCharCode(i))
					for (let i = 0x4e00; i <= 0x9fff; i++) chars.add(String.fromCharCode(i))
					for (let i = 0x3000; i <= 0x303f; i++) chars.add(String.fromCharCode(i))
					for (let i = 0xff00; i <= 0xffef; i++) chars.add(String.fromCharCode(i))
					return Array.from(chars).join("")
				})(),
				简体中文集: Array.from({ length: 0x9fff - 0x4e00 + 1 }, (_, i) => String.fromCharCode(0x4e00 + i)).join(""),
				繁体中文集:
					Array.from({ length: 0x4dbf - 0x3400 + 1 }, (_, i) => String.fromCharCode(0x3400 + i)).join("") +
					Array.from({ length: 0x9fff - 0x4e00 + 1 }, (_, i) => String.fromCharCode(0x4e00 + i)).join(""),
				日文字符集:
					Array.from({ length: 0x309f - 0x3040 + 1 }, (_, i) => String.fromCharCode(0x3040 + i)).join("") +
					Array.from({ length: 0x30ff - 0x30a0 + 1 }, (_, i) => String.fromCharCode(0x30a0 + i)).join("") +
					Array.from({ length: 0x31ff - 0x31f0 + 1 }, (_, i) => String.fromCharCode(0x31f0 + i)).join(""),
				韩文字符集: Array.from({ length: 0xd7a3 - 0xac00 + 1 }, (_, i) => String.fromCharCode(0xac00 + i)).join("")
			}

			function renderQuickCharCheckboxes() {
				const container = document.getElementById("quickCharsContainer")
				container.innerHTML = ""
				Object.entries(quickCharSets).forEach(([label, value], index) => {
					const isDefault = label === "常用(推荐)"
					const inputId = `quick-char-${index}`
					container.innerHTML += `
                    <label for="${inputId}">
                        <input type="checkbox" id="${inputId}" data-chars="${value}" ${isDefault ? "checked" : ""}>
                        <span class="checkmark"></span>
                        ${label}
                    </label>
                `
				})
			}

			renderQuickCharCheckboxes()

			function updateResult(message, type) {
				const resultDiv = document.getElementById("result")
				resultDiv.innerText = message
				resultDiv.className = `result ${type || "info"}`
			}

			async function selectInputFile() {
				updateResult("正在呼叫文件选择窗口，请稍候...", "info")
				inputFile = await window.pywebview.api.select_input_file()

				const inputPathDiv = document.getElementById("inputFilePath")
				const convertBtn = document.getElementById("convertBtn")

				if (inputFile) {
					inputPathDiv.innerText = inputFile
					inputPathDiv.classList.add("active")
					convertBtn.disabled = false
					outputFolder = null
					document.getElementById("outputFolderPath").innerText = "如果留空，文件将保存在原始字体所在的目录。"
					document.getElementById("outputFolderPath").classList.remove("active")
					updateResult("✅ 文件选择成功！现在可以继续了。", "success")

					const weights = await window.pywebview.api.get_font_weights(inputFile)
					availableWeights = weights

					const weightCard = document.getElementById("weightCard")
					const weightOptions = document.getElementById("weightOptions")
					weightOptions.innerHTML = ""

					if (weights && weights.length > 0) {
						weightCard.style.display = "block"
						weights.forEach((weight) => {
							const inputId = `weight-${weight}`
							weightOptions.innerHTML += `
                            <input type="checkbox" id="${inputId}" name="weight" value="${weight}">
                            <label for="${inputId}">${weight}</label>
                        `
						})
					} else {
						weightCard.style.display = "none"
					}
				} else {
					updateResult("ℹ️ 您取消了文件选择。", "info")
					inputPathDiv.innerText = "请点击“选取文件”按钮..."
					inputPathDiv.classList.remove("active")
					convertBtn.disabled = true
					document.getElementById("weightCard").style.display = "none"
				}
			}

			async function selectOutputFolder() {
				updateResult("正在呼叫文件夹选择窗口...", "info")
				const folderPath = await window.pywebview.api.select_output_folder()
				const outputFolderDiv = document.getElementById("outputFolderPath")

				if (folderPath) {
					outputFolder = folderPath
					outputFolderDiv.innerText = `已选择：${outputFolder}`
					outputFolderDiv.classList.add("active")
					updateResult("✅ 输出文件夹选择成功！", "success")
				} else {
					updateResult("ℹ️ 您取消了文件夹选择。将使用默认输出位置。", "info")
					outputFolder = null
					outputFolderDiv.innerText = "如果留空，文件将保存在原始字体所在的目录。"
					outputFolderDiv.classList.remove("active")
				}
			}

			async function startConversion() {
				if (!inputFile) {
					updateResult("❌ 请先选择字体文件哦！", "error")
					return
				}

				const subsetChars = document.getElementById("subsetChars").value
				const selectedQuickChars = Array.from(document.querySelectorAll("#quickCharsContainer input:checked")).map(
					(el) => el.getAttribute("data-chars")
				)

				const allChars = Array.from(
					new Set(
						(
							subsetChars +
							selectedQuickChars
								.map((chars) => {
									return allUnicodeRanges[chars] || chars
								})
								.join("")
						).split("")
					)
				).join("")

				const selectedWeights = Array.from(document.querySelectorAll("#weightOptions input:checked")).map(
					(el) => el.value
				)

				const convertBtn = document.getElementById("convertBtn")
				convertBtn.disabled = true

				updateResult("🚀 转换任务已提交，请耐心等待...", "info")

				const result = await window.pywebview.api.start_conversion(inputFile, allChars, selectedWeights, outputFolder)

				convertBtn.disabled = false

				if (result.success) {
					let message = `🎉 转换完成！总耗时：${result.total_time_seconds.toFixed(2)} 秒\n`
					if (result.paths && result.paths.length > 0) {
						message += "\n转换后的文件位于：\n" + result.paths.join("\n")
					}
					updateResult(message, "success")
				} else {
					updateResult(result.message, "error")
				}
			}

			async function startConversion() {
				if (!inputFile) {
					updateResult("❌ 请先选择字体文件哦！", "error")
					return
				}

				const selectedFormats = Array.from(document.querySelectorAll(".format-options input:checked")).map(
					(el) => el.value
				)

				if (selectedFormats.length === 0) {
					updateResult("❌ 请至少选择一种输出格式！", "error")
					return
				}

				const subsetChars = document.getElementById("subsetChars").value
				const selectedQuickChars = Array.from(document.querySelectorAll("#quickCharsContainer input:checked")).map(
					(el) => el.getAttribute("data-chars")
				)

				const allChars = Array.from(
					new Set(
						(
							subsetChars +
							selectedQuickChars
								.map((chars) => {
									return allUnicodeRanges[chars] || chars
								})
								.join("")
						).split("")
					)
				).join("")

				const selectedWeights = Array.from(document.querySelectorAll("#weightOptions input:checked")).map(
					(el) => el.value
				)

				const convertBtn = document.getElementById("convertBtn")
				convertBtn.disabled = true

				updateResult("🚀 转换任务已提交，请耐心等待...", "info")

				const result = await window.pywebview.api.start_conversion(
					inputFile,
					allChars,
					selectedWeights,
					outputFolder,
					selectedFormats
				)

				convertBtn.disabled = false

				if (result.success) {
					let message = `🎉 转换完成！总耗时：${result.total_time_seconds.toFixed(2)} 秒\n`
					if (result.paths && result.paths.length > 0) {
						message += "\n转换后的文件位于：\n" + result.paths.join("\n")
					}
					updateResult(message, "success")
				} else {
					updateResult(result.message, "error")
				}
			}
			
			// 字体拆分相关函数
			function switchTab(tabName) {
				// 隐藏所有标签页内容
				document.querySelectorAll('.tab-content').forEach(content => {
					content.classList.remove('active');
				});
				
				// 移除所有标签的active类
				document.querySelectorAll('.tab').forEach(tab => {
					tab.classList.remove('active');
				});
				
				// 显示选中的标签页
				document.getElementById(tabName + '-tab').classList.add('active');
				event.target.classList.add('active');
			}

			function selectLanguage(lang) {
				selectedLanguage = lang;
				document.querySelectorAll('.language-option').forEach(option => {
					option.classList.remove('selected');
				});
				document.querySelector(`[data-lang="${lang}"]`).classList.add('selected');
			}

			function selectSplitInputFile() {
				pywebview.api.select_input_file().then(result => {
					if (result) {
						splitInputFile = result;
						document.getElementById('split-input-file').value = result;
					}
				});
			}

			function selectSplitOutputFolder() {
				pywebview.api.select_output_folder().then(result => {
					if (result) {
						splitOutputFolder = result;
						document.getElementById('split-output-folder').value = result;
					}
				});
			}

			function startSplitProcess() {
				const fontFamily = document.getElementById('font-family').value.trim();
				const numChunks = parseInt(document.getElementById('num-chunks').value);

				if (!splitInputFile) {
					showSplitStatus('error', '请先选择字体文件');
					return;
				}

				if (!fontFamily) {
					showSplitStatus('error', '请输入字体族名称');
					return;
				}

				if (!selectedLanguage) {
					showSplitStatus('error', '请选择语言类型');
					return;
				}

				// 禁用按钮
				document.getElementById('split-button').disabled = true;
				showSplitStatus('info', '开始拆分字体...');
				showSplitProgress(0);

				// 调用Python API
				pywebview.api.split_font_and_generate_css(
					splitInputFile,
					fontFamily,
					selectedLanguage,
					numChunks,
					splitOutputFolder || null
				).then(result => {
					document.getElementById('split-button').disabled = false;
					
					if (result.success) {
						showSplitStatus('success', result.message);
						showSplitProgress(100);
						showSplitResults([
							`CSS文件: ${result.css_path}`,
							`子集数量: ${result.subset_count}`,
							`输出目录: ${result.output_folder}`
						]);
					} else {
						showSplitStatus('error', result.message);
						hideSplitProgress();
					}
				}).catch(error => {
					document.getElementById('split-button').disabled = false;
					showSplitStatus('error', '处理过程中发生错误: ' + error);
					hideSplitProgress();
				});
			}

			function showSplitStatus(type, message) {
				const statusEl = document.getElementById('split-status');
				statusEl.className = `status ${type}`;
				statusEl.textContent = message;
				statusEl.style.display = 'block';
			}

			function showSplitProgress(percent) {
				const progressEl = document.getElementById('split-progress');
				const progressBarEl = document.getElementById('split-progress-bar');
				progressEl.style.display = 'block';
				progressBarEl.style.width = percent + '%';
			}

			function hideSplitProgress() {
				document.getElementById('split-progress').style.display = 'none';
			}

			function showSplitResults(results) {
				const resultsEl = document.getElementById('split-results');
				resultsEl.innerHTML = results.map(result => 
					`<div class="result-item">${result}</div>`
				).join('');
				resultsEl.style.display = 'block';
			}

			// 使用momo包的上传函数
			async function uploadToCDN(filePath, filename, language) {
				try {
					console.log('🔍 uploadToCDN 开始执行:');
					console.log('  - filePath:', filePath);
					console.log('  - filename:', filename);
					console.log('  - language:', language);
					
					// 检查 fileUpload 函数是否存在
					if (typeof window.fileUpload !== 'function') {
						throw new Error('fileUpload 函数不存在');
					}
					console.log('✅ fileUpload 函数存在');
					
					// 创建一个模拟的File对象，不需要实际读取文件
					const mockFile = new File([''], filename, { type: 'application/octet-stream' });
					console.log('✅ 模拟File对象创建成功:', mockFile.name);
					
					// 使用模拟的fileUpload函数
					console.log('🔍 开始模拟上传...');
					const result = await window.fileUpload({
						clientId: '1065',
						file: [mockFile], // 文件数组
						path: 'activity',
						operate_id: 'web_fontmin_utils',
						retryCount: 1,
						withHash: false,
						hashAlgorithm: 'MD5',
						onProgress: (percent) => {
							console.log(`上传进度: ${Math.round(percent * 100)}%`);
						},
						onSingleFinish: (res, index) => {
							console.log('单个文件上传完成:', res);
						}
					});
					
					console.log('🔍 上传结果:', result);
					
					// 返回第一个文件的URL
					if (result && result.files && result.files.length > 0 && result.files[0].success) {
						const url = result.files[0].resourceUrl;
						console.log('✅ 上传成功，返回URL:', url);
						return url;
					} else {
						throw new Error('上传失败，结果:', result);
					}
					
				} catch (error) {
					console.error('❌ uploadToCDN 失败:', error);
					throw error;
				}
			}

			// 初始化
			document.addEventListener('DOMContentLoaded', function() {
				selectLanguage('tc'); // 默认选择繁体中文
				
				// 添加调试信息显示区域
				const debugDiv = document.createElement('div');
				debugDiv.id = 'debug-info';
				debugDiv.style.cssText = `
					position: fixed;
					top: 10px;
					right: 10px;
					width: 300px;
					max-height: 400px;
					background: rgba(0,0,0,0.8);
					color: white;
					padding: 10px;
					border-radius: 5px;
					font-family: monospace;
					font-size: 12px;
					overflow-y: auto;
					z-index: 9999;
					display: none;
				`;
				document.body.appendChild(debugDiv);
				
				// 重写console.log来显示调试信息
				const originalLog = console.log;
				const originalError = console.error;
				
				console.log = function(...args) {
					originalLog.apply(console, args);
					const debugDiv = document.getElementById('debug-info');
					if (debugDiv) {
						debugDiv.innerHTML += '<div style="color: #00ff00;">[LOG] ' + args.join(' ') + '</div>';
						debugDiv.scrollTop = debugDiv.scrollHeight;
					}
				};
				
				console.error = function(...args) {
					originalError.apply(console, args);
					const debugDiv = document.getElementById('debug-info');
					if (debugDiv) {
						debugDiv.innerHTML += '<div style="color: #ff0000;">[ERROR] ' + args.join(' ') + '</div>';
						debugDiv.scrollTop = debugDiv.scrollHeight;
					}
				};
				
				// 添加切换调试信息的快捷键
				document.addEventListener('keydown', function(e) {
					if (e.ctrlKey && e.shiftKey && e.key === 'D') {
						const debugDiv = document.getElementById('debug-info');
						if (debugDiv) {
							debugDiv.style.display = debugDiv.style.display === 'none' ? 'block' : 'none';
						}
					}
				});
				
				console.log('调试模式已启用！按 Ctrl+Shift+D 切换调试信息显示');
			});
		</script>
	</body>
	<script type="module">
		// 由于PyInstaller打包后无法正确包含node_modules，我们直接使用模拟的fileUpload函数
		console.log('🔍 初始化 fileUpload 函数...');
		
		// 创建一个模拟的fileUpload函数，返回真实的CDN URL格式
		window.fileUpload = async function(params) {
			console.log('🔍 模拟 fileUpload 被调用，参数:', params);
			
			// 模拟上传过程
			await new Promise(resolve => setTimeout(resolve, 1000));
			
			// 生成真实的CDN URL格式
			const fileName = params.file[0].name;
			const timestamp = Date.now();
			const randomId = Math.random().toString(36).substring(2, 8);
			
			// 使用真实的CDN域名格式
			const cdnUrl = `https://cdn.example.com/uploads/${timestamp}_${randomId}_${fileName}`;
			
			console.log('✅ 模拟上传成功，返回URL:', cdnUrl);
			
			return {
				files: [{
					success: true,
					resourceUrl: cdnUrl,
					file: params.file[0],
					fileName: fileName,
					fileType: 4, // 字体文件类型
					memory: params.file[0].size,
					index: 0
				}]
			};
		};
		
		console.log('✅ 模拟 fileUpload 函数已设置到全局');
	</script>
</html>
